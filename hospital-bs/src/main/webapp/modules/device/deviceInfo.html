<!DOCTYPE html>

<html>

	<head>
		<meta charset="utf-8">
		<title>编辑设备管理表</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" href="../../static/layui/css/layui.css" media="all">
		<link rel="stylesheet" href="../../static/layui/modules/formSelect/formSelects-v4.css" media="all">

<style>
.layui-input-block2 {
	margin-left: 110px;
	min-height: 36px;
	padding-right:20px;
	font-size: 14px;
}

.layui-input-inline2 {
	display: inline-block;
	vertical-align: middle;

}
</style>
	</head>
	<body>
		<div class="layui-form" lay-filter="layuiadmin-form-useradmin" id="layuiadmin-form-useradmin" style="padding: 20px 0 0 0;">
			<div class="layui-card-body layui-row layui-col-space10">
					<input type="hidden" class="layui-input" id="hospitalId" name="hospitalId" >
					<input type="hidden" class="layui-input" id="departId" name="departId" >
						<div class="layui-col-md5">
                            <label class="layui-form-label">设备编码</label>
                            <div class="layui-input-block layui-input-title">
								   <input type="text" class="layui-input" placeholder="请输入设备编码" name="deviceCode" lay-verify="required"></input>
							</div>
                        </div>
                        <div class="layui-col-md5">
                            <label class="layui-form-label">设备名称</label>
                            <div class="layui-input-block layui-input-title">
								   <input type="text" class="layui-input" placeholder="请输入设备名称" name="deviceName" lay-verify="required"></input>
							</div>
                        </div>
                        <div class="layui-col-md5">
                            <label class="layui-form-label">设备大类</label>
                            <div class="layui-input-block layui-input-title">
								 <select type="text" name="deviceLargeType" id="deviceLargeType" llw-dict-code="deviceLargeType" lay-verify="required" lay-filter="deviceLargeType">
								 </select>
							</div>
                        </div>
						<div class="layui-col-md5">
                            <label class="layui-form-label">设备类型</label>
                            <div class="layui-input-block layui-input-title layui-form" lay-filter="deviceType">
								 <select type="text" name="deviceType" id="deviceType" lay-verify="required" >
								 </select>
							</div>
                        </div>
						<div class="layui-col-md5">
                            <label class="layui-form-label">选择机构</label>
                            <div class="layui-input-block layui-input-title">
								<input type="text" id="tree" lay-filter="tree" class="layui-input" name="orgId" lay-verify="required">
							</div>
                        </div>
                        <div class="layui-col-md5">
                            <label class="layui-form-label">所属机构</label>
                            <div class="layui-input-block layui-input-title">
								  <input type="text" class="layui-input" name="hospitalName" readonly="readonly"></input>
							</div>
                        </div>
                        <div class="layui-col-md5">
                            <label class="layui-form-label">所属科室</label>
                            <div class="layui-input-block layui-input-title">
								   <input type="text" class="layui-input" name="departName" readonly="readonly"></input>
							</div>
                        </div>
                        
                        <div class="layui-col-md5">
                            <label class="layui-form-label">设备位置</label>
                            <div class="layui-input-block layui-input-title">
                            	  <input type="text"  class="layui-input" placeholder="请输入安装位置" name="location"></input>
							</div>
                        </div>
                        <div class="layui-col-md10" id="recogBusiDiv">
                         	 <label class="layui-form-label">认证业务</label>
                         	 <div class="layui-input-block2 layui-input-title2">
                         	 	<select name="recogBusi"  id="recogBusi" xm-select="select1" xm-select-skin="normal" lay-filter="recogBusi-lay-filter" xm-select-direction="down">
                        			
                        			<option value="12">入科认证</option> 
			                        <option value="14">实人门诊</option>
			                        <!-- 
			                        <option value="10">抽查认证</option>
			                        <option value="11">普查认证</option>
			                        <option value="12">入科认证</option> 
			                        <option value="14">实人门诊</option>
			                        <option value="15">实人购药</option>   
			                        <option value="21">检查诊疗签到</option>
			                        <option value="22">检查诊疗签退</option>
			                         -->
							</select>
							</div>
                         </div>
                         
                         <div class="layui-col-md5" id="netTypeDiv" style="display: none;">
                            <label class="layui-form-label">联网方式</label>
                            <div class="layui-input-block layui-input-title">
                            	  <select type="text" name="netType" id="netType" llw-dict-code="domainType">
								 </select>
							</div>
                        </div>

						<div class="layui-col-md5" id="archiveType" style="display: none;">
							<label class="layui-form-label">归档方式</label>
							<div class="layui-input-block layui-input-title">
								<select type="text" name="archiveType">
									<option value="">请选择</option>
									<option value="0">异步</option>
									<option value="1">实时</option>
								</select>
							</div>
						</div>
						<div class="layui-col-md5" id="cameraIndexCodeDiv" style="display: none;">
							<label class="layui-form-label">监控点标识</label>
							<div class="layui-input-block layui-input-title">
								<input type="text"  class="layui-input" placeholder="请输入监控点标识" name="cameraIndexCode"></input>
							</div>
						</div>
					<div class="layui-col-md10" id="streamUrlDiv" style="display: none;">
						<label class="layui-form-label">实时流地址</label>
						<div class="layui-input-block layui-input-title">
							<input type="text"  class="layui-input" placeholder="海康相机例子rtsp://username:passwd@ip:554/h264/ch1/main/av_stream" name="streamUrl"></input>
						</div>
					</div>
				</div>
			<button id="LAY-front-submit" style="display: none;" lay-submit="" lay-filter="LAY-front-submit"></button>
		</div>
		<script src="../../static/layui/layui.js"></script>
   		<script src="../../static/layui/modules/formSelects.js"></script>
		<script>
			layui.config({
				base: '../../static/layui/' //静态资源所在路径
			}).extend({
				index: 'modules/index', //主入口模块
				treeSelect: 'treeSelect/treeSelect'
			}).use(['index','form', 'layer','formSelects','treeSelect'], function() {
				var $ = layui.$
				,laydate = layui.laydate
				,form = layui.form
				,treeSelect= layui.treeSelect
				,formSelects = layui.formSelects;

				 treeSelect.render({
			            // 选择器
			            elem: '#tree',
			            data: '../../medical/sysOrganization/orgListTree.jspx',
			            // 异步加载方式：get/post，默认get
			            type: 'get',
			            // 占位符
			            placeholder: '请选择组织机构',
			            // 是否开启搜索功能：true/false，默认false
			            search: true,
			            style: {
			                folder: {
			                    enable: false
			                },
			                line: {
			                    enable: true
			                }
			            },
			            // 点击回调
			            click: function(d){
			            	
			            	//选择的是医院科室为空，选择的是科室，科室为所选值，医院为pid
			            	if(d.current.type == 1){//医院
			            		$("input[name='hospitalId']").val(d.current.id);
			            		$("input[name='hospitalName']").val(d.current.name);
			            		$("input[name='departId']").val('');
			            		$("input[name='departName']").val('');
			            	}
			            	if(d.current.type == 2 || d.current.type == 3 ){//科室
			            		$("input[name='hospitalId']").val(d.current.pid);
			            		$("input[name='hospitalName']").val(d.current.pname);
			            		$("input[name='departId']").val(d.current.id);
			            		$("input[name='departName']").val(d.current.name);
			            	}
			                $("input[name='orgId']").val(d.current.id);
			            },
			            // 加载完成后的回调函数
			            success: function (d) {
			            	setTimeout(function(){
								var orgId = $("input[name='orgId']").val();
								if(orgId != null && orgId != ""){
									treeSelect.checkNode('tree', orgId);
								}
							}, 100);
			            }
			        });


				var pk = layui.util.getUrlParam("deviceCode");
				var zoneCode;
				var serverId;
				var deviceType;
				if(pk) {
					//------- 设置修改页面的属性值   ------
					layui.util.ajax({
						url: "./../../medical/device/info.jspx?deviceCode=" + pk,
						success: function(res) {
							if(res.respData) {
								layui.$("input,select,textarea").each(function() {
									$(this).val(res.respData[this.name]);
								});
								
								zoneCode = res.respData.zoneCode;
								serverId = res.respData.serverId;
								deviceType = res.respData.deviceType;
								
								setTimeout(function () {
									var recogBusi = res.respData.recogBusi;
									var recogBusiArray = new Array();
									if(null != recogBusi){
										if(recogBusi.length > 0){
											var recogBusiArray = recogBusi.split(",");
											formSelects.value('select1', recogBusiArray);
										}
									}
									
									var cureItem = res.respData.cureItem;
									var cureItemArray = new Array();
									if(null != cureItem){
										if(cureItem.length > 0){
											var cureItemArray = cureItem.split(",");
											formSelects.value('select2', cureItemArray);
										}
									}
									form.val('layuiadmin-form-useradmin',res.respData);
								},200);


							}
						}
					});
				}
				
				 var opType = layui.util.getUrlParam("event");
				 if('info'==opType){
					 $("input[name='orgId']").addClass("layui-disabled");
					 $("input[name='orgId']").attr("disabled","disabled");
					 $("input[name='productCode']").addClass("layui-disabled");
					 $("input[name='productCode']").attr("disabled","disabled");
					 $("input[name='macAddress']").addClass("layui-disabled");
					 $("input[name='macAddress']").attr("disabled","disabled");
					 $("input[name='deviceCode']").addClass("layui-disabled");
					 $("input[name='deviceCode']").attr("disabled","disabled");
					 $("input[name='hardVersion']").addClass("layui-disabled");
					 $("input[name='hardVersion']").attr("disabled","disabled");
					 $("input[name='softVersion']").addClass("layui-disabled");
					 $("input[name='softVersion']").attr("disabled","disabled");
					 $("input[name='osVersion']").addClass("layui-disabled");
					 $("input[name='osVersion']").attr("disabled","disabled");
					 $("input[name='hospitalName']").addClass("layui-disabled");
					 $("input[name='departName']").addClass("layui-disabled");
					 $("input[name='deviceName']").addClass("layui-disabled");
					 $("input[name='deviceName']").attr("disabled","disabled");
					 $("input[name='ipAddress']").addClass("layui-disabled");
					 $("input[name='ipAddress']").attr("disabled","disabled");
					 $("input[name='userName']").addClass("layui-disabled");
					 $("input[name='userName']").attr("disabled","disabled");
					 $("input[name='userPwd']").addClass("layui-disabled");
					 $("input[name='userPwd']").attr("disabled","disabled");

				 }
				 if('update'==opType){
					 $("input[name='deviceCode']").addClass("layui-disabled");
					 $("input[name='deviceCode']").attr("disabled","disabled");
				 }

				 
				 

	            form.on("select(zoneCode)", function(data){
			        serverList(data.value);
			    });
				 function serverList(value){
					 $.ajax({
		                  type:'get',
		                  url: "../../medical/server/serverList.jspx?zoneCode="+value+"&serverType=6",//只查算力服务器
		                  success:function(data){
		                	  $("#serverId").empty();
		                	  if(data != undefined && data != null && data != ""){
		                          var html="<option value=''>请选择服务器</option>";
		                          var dataList = data.respData;
		                          for(var i = 0 ;i < dataList.length ; i++){
		                        	  if(serverId == dataList[i].serverId){
		                        		  html+="<option value="+dataList[i].serverId+"  selected='selected'>"+dataList[i].serverName+"</option>";
		                        	  }else{
		                        		  html+="<option value="+dataList[i].serverId+">"+dataList[i].serverName+"</option>";

		                        	  }

		                          }
		                          $("#serverId").append(html);
		                      }
		                     form.render('select','serverId-lay-filter');
		                 }
		             })
				 }
				 
				 form.on("select(deviceLargeType)", function(data){
					 deviceTypeList(data.value);
					  if(data.value == 2){
						// $("#recogBusiDiv").show();
						 $("#netTypeDiv").show();
						 $("#cameraPicServerTypeDiv").show();
						 $("#cameraIndexCodeDiv").show();
						  $("#archiveType").show();
						 $("#recogBusiDiv").show();
						 $("#streamUrlDiv").show();
						 
					 }
					 if(data.value == 1){
						// $("#recogBusiDiv").hide();
						 $("#netTypeDiv").hide();
						 $("#cameraPicServerTypeDiv").hide();
						 $("#cameraIndexCodeDiv").hide();
						 $("#streamUrlDiv").hide();
						 $("#archiveType").hide();
					 } 
				    });
				 
				 function deviceTypeList(value){
					 $.ajax({
		                  type:'get',
		                  url: "../../medical/sysDeviceType/getByDeviceLargeType.jspx?deviceLargeType="+value,
		                  success:function(data){
		                	  $("#deviceType").empty();
		                	  if(data != undefined && data != null && data != ""){
		                          var html="<option value=''>请选择设备类型</option>";
		                          var dataList = data.respData;
		                          for(var i = 0 ;i < dataList.length ; i++){
		                        	  if(deviceType == dataList[i].deviceType){
		                        		  html+="<option value='"+dataList[i].deviceType+"'  selected='selected'>"+dataList[i].deviceName+"</option>";
		                        	  }else{
		                        		  html+="<option value='"+dataList[i].deviceType+"'>"+dataList[i].deviceName+"</option>";

		                        	  }
		                          }
		                          $("#deviceType").append(html);
		                      }
		                     form.render('select','deviceType');
		                 }
		             })
				 }
				

			})
		</script>
	</body>

</html>
